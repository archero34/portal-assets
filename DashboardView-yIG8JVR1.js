import{P as Oe}from"./PageView-BfH8tsmj.js";import{d as Se,r as u,o as Ee,n as je,a as ze,b as z,c as Z,e as He,f as ee,t as $e,u as re,g as le,h as Ge,i as Ke,w as ve,j as e,k as t,F as pe,l as N,m as q,p as Te,q as I,s as ge,v as V,x as fe,y as _e,L as ye}from"./index-njxYMIA0.js";import{c as M,r as B,e as Ye,u as we,C as Je}from"./contactUseCases-BU1aOxSl.js";import{i as he,d as X}from"./index-CS5tPIud.js";import{B as be}from"./BlueCollarForm-TCyGM1Se.js";import{B as Qe,a as Le}from"./BlueCollarModal-BuahIIZF.js";const Re=["placeholder"],We=Se({__name:"GoogleAutocomplete",props:{modelValue:{type:String,default:""},apiKey:{type:String,required:!0},placeholder:{type:String,default:""},isFullPayload:{type:Boolean,default:!1},class:{type:String,default:""}},emits:["update:modelValue","set"],setup(o,{emit:d}){const y=o,c=u(),i=u(),p=u(!1),S=()=>new Promise((l,g)=>{if(window.google&&window.google.maps&&window.google.maps.places)l();else if(!p.value){p.value=!0;const x=document.createElement("script");x.setAttribute("src",`https://maps.googleapis.com/maps/api/js?key=${y.apiKey}&libraries=places&v=weekly&callback=initMap`),window.initMap=()=>{l()},x.onerror=async F=>{g(F)},document.head.appendChild(x)}}),w=()=>{if(c.value){const l=google.maps.places,g=new l.Autocomplete(c.value,{fields:["formatted_address","address_components","geometry","name"],strictBounds:!1});g.addListener("place_changed",async()=>{var x,F,Y;i.value=await g.getPlace();const H=await i.value.geometry.location.lat(),J=await i.value.geometry.location.lng();let G="",K="",D="";for(const k of(x=i.value)==null?void 0:x.address_components)k.types.includes("locality")?G=await k.long_name:k.types.includes("administrative_area_level_1")?K=await k.long_name:k.types.includes("country")&&(D=await k.long_name);const Q={name:(F=i.value)==null?void 0:F.name,city:G,state:K,country:D,latitude:H,longitude:J};d("update:modelValue",(Y=i.value)==null?void 0:Y.name),y.isFullPayload?d("set",i.value):d("set",Q)})}};return Ee(async()=>{try{await S(),await je(),w()}catch(l){console.error("Failed to load Google Maps API",l)}}),ze(()=>{delete window.initMap}),(l,g)=>(z(),Z("input",{ref_key:"origin",ref:c,type:"text",class:He(o.class),placeholder:o.placeholder},null,10,Re))}}),Xe=()=>{const o=ee({serviceLocations:[],serviceLocation:{},totalItems:0,errors:[]}),d=async(c,i,p,S)=>{try{const w=re(c,i,p,S),{payload:l,errors:g}=await le(`&handler=asset&dataset=listPaged&filters=custrecord_nx_asset_type,ANYOF,1${w}`);l.value?(o.serviceLocations=l.value.items,o.totalItems=l.value.totalPages*parseInt(l.value.pageSize)):(o.serviceLocations=[],o.totalItems=0),o.errors=g.value}catch(w){console.error(w),o.errors=[w.message]}},y=async(c,i)=>{try{const{payload:p,errors:S}=await Ge(`&handler=asset&dataset=create&currentUserId=${i}`,JSON.stringify(c));o.serviceLocation=p.value,o.errors=S.value}catch(p){console.error(p),o.errors=[p.message]}};return{...$e(o),list:d,create:y}},{list:Ze,create:ea,serviceLocations:aa,serviceLocation:ta,totalItems:sa,errors:Ve}=Xe();class oa{async getServiceLocations(d,y,c,i){return await Ze(d,y,c,i),{serviceLocations:aa,totalItems:sa,errors:Ve}}async createServiceLocation(d,y){return await ea({id:"",bodyFields:d},y),{serviceLocation:ta,errors:Ve}}}const ra=()=>{const o=ee({addresses:[],address:{},totalItems:0,errors:[]}),d=async(c,i,p,S)=>{try{const w=re(c,i,p,S),{payload:l,errors:g}=await le(`&handler=customer&dataset=list${w}`);l.value?(o.addresses=l.value.items,o.totalItems=l.value.totalPages*parseInt(l.value.pageSize)):(o.addresses=[],o.totalItems=0)}catch(w){console.error(w),o.errors=[w.message]}},y=async(c,i,p,S,w)=>{try{const l=re(i,p,S,w),{payload:g,errors:x}=await le(`&handler=customer&dataset=listAddresses&currentUserId=${c}${l}`);g.value?(o.addresses=g.value.items,o.totalItems=g.value.totalPages*parseInt(g.value.pageSize)):(o.addresses=[],o.totalItems=0),o.errors=x.value}catch(l){console.error(l),o.errors=[l.message]}};return{...$e(o),list:d,listFilter:y}},{list:la,listFilter:na,addresses:xe,totalItems:Ce,errors:Ne}=ra();class ia{async getAddresses(d,y,c,i){return await la(d,y,c,i),{addresses:xe,totalItems:Ce,errors:Ne}}async getAddressesList(d,y,c,i,p){return await na(d,y,c,i,p),{addresses:xe,totalItems:Ce,errors:Ne}}}const da={class:"font-weight-bold"},ca=I("span",{class:"bc-text bc-fs-20 bc-fw-600 pt-8"},"Create New Contact",-1),ua={class:"create-form-actions"},ma=I("span",{class:"bc-text bc-fs-20 bc-fw-600 pt-8"},"Create New Service Location",-1),va={class:"create-form-actions"},pa=I("span",{class:"bc-text bc-text-gray-800 bc-fs-16 bc-fw-600 text-center"},"Your request has been sent successfully.",-1),ba=Se({__name:"DashboardView",props:{user:{}},setup(o){const{setAlert:d}=Ke(),{getAddresses:y}=new ia,{getContacts:c,createContact:i}=new Je,{getServiceLocations:p,createServiceLocation:S}=new oa,w=o,l=void 0,g=window.innerHeight*.52,x=u([]),F=u([]),Y=u(0),H=u(!1),J=u([]),G=u([]),K=u(0),D=u(!1),Q=u([]),k=u([]),ne=u(0),ae=u(!1),ie={firstName:"",lastName:"",email:"",phone:""},m=ee({...ie}),de={address:"",latitude:"",longitude:""},f=ee({...de}),O=u(!1),te=u(!1),E=u(!1),se=u(!1),R=u(!1),ke={firstName:{required:M.withMessage("First Name is required",B)},lastName:{required:M.withMessage("Last Name is required",B)},email:{required:M.withMessage("Email is required",B),email:Ye},phone:{required:M.withMessage("Mobile phone is required",B)}},Pe={address:{required:M.withMessage("Address is required",B)},latitude:{required:M.withMessage("Latitude is required",B)},longitude:{required:M.withMessage("Longitude is required",B)}},j=we(ke,m),T=we(Pe,f),W=()=>{j.value.$reset(),T.value.$reset();for(const[n,s]of Object.entries(ie))m[n]=s;for(const[n,s]of Object.entries(de))f[n]=s},qe=async({page:n,itemsPerPage:s,sortBy:h,filterBy:P})=>{var C,$;H.value=!0;const{addresses:L,totalItems:A,errors:b}=await y(n,s,h,P);b.value.length>0&&b.value[0]!=="Invalid page range: fetch."?(console.error("Error loading addresses:",b.value),d()):(x.value=((C=L.value)==null?void 0:C.length)>0?L.value[0].reduce((_,r)=>(r.id!=="internalid"&&_.push({title:r.label,key:r.id}),_),[]):[],F.value=($=L.value)==null?void 0:$.map(_=>_.reduce((r,v)=>{if(v.id)return r[v.id]=v.text??v.value,r},{})),Y.value=A.value),H.value=!1},ce=async({page:n,itemsPerPage:s,sortBy:h,filterBy:P})=>{var C,$;D.value=!0;const{contacts:L,totalItems:A,errors:b}=await c(n,s,h,P);b.value.length>0&&b.value[0]!=="Invalid page range: featch."?(console.error("Error loading contacts",b.value),d()):(J.value=((C=L.value)==null?void 0:C.length)>0?L.value[0].reduce((_,r)=>(r.id!=="internalid"&&_.push({title:r.label,key:r.id}),_),[]):[],G.value=($=L.value)==null?void 0:$.map(_=>_.reduce((r,v)=>{if(v.id)return r[v.id]=v.text??v.value,r},{})),K.value=A.value),D.value=!1},ue=async({page:n,itemsPerPage:s,sortBy:h,filterBy:P})=>{var C,$;ae.value=!0;const{serviceLocations:L,totalItems:A,errors:b}=await p(n,s,h,P);b.value.length>0&&b.value[0]!=="Invalid page range: featch."?(console.error("Error loading contacts",b.value),d()):(Q.value=((C=L.value)==null?void 0:C.length)>0?L.value[0].reduce((_,r)=>(r.id!=="internalid"&&_.push({title:r.label,key:r.id}),_),[]):[],k.value=($=L.value)==null?void 0:$.map(_=>_.reduce((r,v)=>{if(v.id)return r[v.id]=v.text??v.value,r},{})),ne.value=A.value),ae.value=!1},Ie=()=>O.value=!O.value,Fe=()=>E.value=!E.value,Ae=async()=>{await j.value.$validate()&&(te.value=!0,await Me(),te.value=!1,ce({page:1,itemsPerPage:X}))},Ue=async()=>{await T.value.$validate()&&(se.value=!0,await Be(),se.value=!1,ue({page:1,itemsPerPage:X}))},Me=async()=>{const n=[{id:"firstname",value:m.firstName,text:m.firstName},{id:"lastname",value:m.lastName,text:m.lastName},{id:"email",value:m.email,text:m.email},{id:"phone",value:m.phone,text:m.phone}],{contact:s,errors:h}=await i(n,w.user.id);return h.value.length>0?(console.error("Error creating new contact",h.value),d()):R.value=!0,O.value=!1,W(),s},Be=async()=>{const n=[{id:"custrecord_nx_asset_address_text",value:f.address,text:f.address},{id:"custrecord_nx_asset_latitude",value:f.latitude,text:f.latitude},{id:"custrecord_nx_asset_longitude",value:f.longitude,text:f.longitude}],{serviceLocation:s,errors:h}=await S(n,w.user.id);return h.value.length>0?(console.error("Error creating new Service Location",h.value),d()):R.value=!0,E.value=!1,W(),s},De=n=>{f.address=n.formatted_address,f.latitude=n.geometry.location.lat(),f.longitude=n.geometry.location.lng()};return ve(O,n=>{n||W()}),ve(E,n=>{n||W()}),(n,s)=>{const h=N("v-icon"),P=N("v-card-title"),L=N("v-data-table"),A=N("v-card-text"),b=N("v-card"),C=N("v-col"),$=N("v-btn"),_=N("v-data-table-server"),r=N("v-row"),v=N("v-container"),U=N("v-text-field"),me=N("v-form");return z(),Z(pe,null,[e(Oe,null,{pagename:t(()=>[q(" Dashboard ")]),_:1}),e(v,null,{default:t(()=>[e(r,{align:"stretch"},{default:t(()=>[e(C,{cols:"12",md:"4"},{default:t(()=>[e(b,{class:"pa-4",style:{height:"100%"}},{default:t(()=>[e(P,{class:"pa-4 d-flex"},{default:t(()=>[e(h,{class:"mr-2"},{default:t(()=>[q("mdi-home-map-marker")]),_:1}),q(" Address ")]),_:1}),e(A,null,{default:t(()=>[e(L,{headers:x.value,loading:H.value,items:[F.value[0]],"item-key":"id",height:g,"onUpdate:options":qe,"hide-default-header":"","hide-default-footer":""},{item:t(a=>[(z(!0),Z(pe,null,Te(x.value,oe=>(z(),Z("tr",{key:oe.key},[I("td",da,ge(oe.title),1),I("td",null,ge(a.item[oe.key]),1)]))),128))]),_:1},8,["headers","loading","items"])]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",md:"8"},{default:t(()=>[e(b,{class:"pa-4",style:{height:"100%"}},{default:t(()=>[e(P,{class:"d-flex",style:{"justify-content":"space-between"}},{default:t(()=>[I("div",null,[e(h,{class:"mr-2"},{default:t(()=>[q("mdi-map-marker-multiple")]),_:1}),q(" Service Locations ")]),e($,{class:"text-none","prepend-icon":"mdi-plus-circle",variant:"text",onClick:Fe},{default:t(()=>[q("Create New")]),_:1})]),_:1}),e(_,{"items-per-page-options":V(he),headers:Q.value,"item-value":a=>a.internalid,items:k.value,"items-per-page":V(X),"items-length":ne.value,loading:ae.value,height:g,"loading-text":"Loading serviceLocations...","multi-sort":"","onUpdate:options":ue},null,8,["items-per-page-options","headers","item-value","items","items-per-page","items-length","loading"])]),_:1})]),_:1})]),_:1}),e(r,null,{default:t(()=>[e(C,null,{default:t(()=>[e(b,{class:"pa-4"},{default:t(()=>[e(P,{class:"d-flex",style:{"justify-content":"space-between"}},{default:t(()=>[I("div",null,[e(h,{class:"mr-2"},{default:t(()=>[q("mdi-account-group")]),_:1}),q(" Contacts ")]),e($,{class:"text-none","prepend-icon":"mdi-plus-circle",variant:"text",onClick:Ie},{default:t(()=>[q("Create New")]),_:1})]),_:1}),e(_,{"items-per-page-options":V(he),headers:J.value,"item-value":a=>a.internalid,"items-per-page":V(X),items:G.value,"items-length":K.value,loading:D.value,height:g,"loading-text":"Loading contacts...","multi-sort":"","onUpdate:options":ce},null,8,["items-per-page-options","headers","item-value","items-per-page","items","items-length","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),e(be,{modelValue:O.value,"onUpdate:modelValue":s[4]||(s[4]=a=>O.value=a)},{header:t(()=>[ca]),content:t(()=>[e(me,{class:"create-form-content"},{default:t(()=>[e(v,null,{default:t(()=>[e(r,{class:"ma-2"},{default:t(()=>[e(U,{label:"First Name",counter:15,modelValue:m.firstName,"onUpdate:modelValue":s[0]||(s[0]=a=>m.firstName=a),"error-messages":V(j).firstName.$errors.map(a=>a.$message),variant:"outlined",density:"comfortable",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(r,{class:"ma-2"},{default:t(()=>[e(U,{label:"Last Name",counter:15,modelValue:m.lastName,"onUpdate:modelValue":s[1]||(s[1]=a=>m.lastName=a),"error-messages":V(j).lastName.$errors.map(a=>a.$message),variant:"outlined",density:"comfortable",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(r,{class:"ma-2"},{default:t(()=>[e(U,{label:"Email",modelValue:m.email,"onUpdate:modelValue":s[2]||(s[2]=a=>m.email=a),"error-messages":V(j).email.$errors.map(a=>a.$message),variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),e(r,{class:"ma-2"},{default:t(()=>[e(U,{label:"Mobile Phone","error-messages":V(j).phone.$errors.map(a=>a.$message),modelValue:m.phone,"onUpdate:modelValue":s[3]||(s[3]=a=>m.phone=a),variant:"outlined",density:"comfortable"},null,8,["error-messages","modelValue"])]),_:1})]),_:1})]),_:1}),te.value?(z(),fe(ye,{key:0})):_e("",!0)]),actions:t(()=>[I("div",ua,[e(Le,{text:"Create New",type:"primary",callback:Ae})])]),_:1},8,["modelValue"]),e(be,{modelValue:E.value,"onUpdate:modelValue":s[8]||(s[8]=a=>E.value=a)},{header:t(()=>[ma]),content:t(()=>[e(me,{class:"create-form-content"},{default:t(()=>[e(v,null,{default:t(()=>[e(r,{class:"ma-2"},{default:t(()=>[e(V(We),{id:"map",class:"custom-autocomplete","api-key":V(l),isFullPayload:!0,onSet:De,placeholder:"Type an address"},null,8,["api-key"])]),_:1}),e(r,{class:"ma-2"},{default:t(()=>[e(U,{label:"Address",modelValue:f.address,"onUpdate:modelValue":s[5]||(s[5]=a=>f.address=a),"error-messages":V(T).address.$errors.map(a=>a.$message),variant:"outlined",density:"comfortable",required:"",readonly:""},null,8,["modelValue","error-messages"])]),_:1}),e(r,{class:"ma-2"},{default:t(()=>[e(U,{label:"Latitude",modelValue:f.latitude,"onUpdate:modelValue":s[6]||(s[6]=a=>f.latitude=a),"error-messages":V(T).latitude.$errors.map(a=>a.$message),variant:"outlined",density:"comfortable",required:"",readonly:""},null,8,["modelValue","error-messages"])]),_:1}),e(r,{class:"ma-2"},{default:t(()=>[e(U,{label:"Longitude",modelValue:f.longitude,"onUpdate:modelValue":s[7]||(s[7]=a=>f.longitude=a),"error-messages":V(T).longitude.$errors.map(a=>a.$message),variant:"outlined",density:"comfortable",required:"",readonly:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),se.value?(z(),fe(ye,{key:0})):_e("",!0)]),actions:t(()=>[I("div",va,[e(Le,{text:"Create New",type:"primary",callback:Ue})])]),_:1},8,["modelValue"]),e(Qe,{type:"primary",modelValue:R.value,"onUpdate:modelValue":s[9]||(s[9]=a=>R.value=a)},{content:t(()=>[pa]),_:1},8,["modelValue"])],64)}}});export{ba as default};
