import{f as Q,t as ce,u as te,h as F,g as H,_ as Z,b as h,c as w,d as ie,i as de,r as k,E as K,o as ue,q as d,j as P,F as me,p as he,y as $,s as M,x as E,C as ve,D as pe,M as ge,k as fe,L as be,m as D}from"./index-njxYMIA0.js";import{_ as we,E as ke}from"./IconClose.vue_vue_type_script_setup_true_lang-ChXQ_y-i.js";import{B as Ce}from"./BlueCollarBadge-QXQIXcG4.js";import{a as Ie,B as Te}from"./BlueCollarContent-OVW-PlcV.js";import{a as G,B as Ue}from"./BlueCollarModal-BuahIIZF.js";const xe=()=>{const e=Q({jobs:[],job:{},serviceLocations:[],totalItems:0,printUrl:"",errors:[]}),n=async(l,s)=>{try{const{page:a,pageSize:o,sortBy:t,filterBy:u}=l,I=te(a,o,t,u),C=s?JSON.stringify({addressText:{text:s}}):null,{payload:f,errors:T}=await F(`&handler=task&dataset=list${I}`,C);f.value?(e.jobs=f.value.items,e.totalItems=f.value.totalPages*parseInt(f.value.pageSize)):(e.jobs=[],e.totalItems=0),e.errors=T.value}catch(a){console.error(a),e.errors=[a.message]}},r=async(l,s)=>{try{const{payload:a,errors:o}=await F(`&handler=task&dataset=load&taskId=${l}`,JSON.stringify(s));e.job=a.value,e.errors=o.value}catch(a){console.error(a),e.errors=[a.message]}},v=async l=>{try{const{payload:s,errors:a}=await H(`&handler=case&dataset=printServiceReport&caseId=${l}`);s.value?(e.printUrl=s.value,e.errors=a.value):e.printUrl=""}catch(s){console.error(s),e.errors=[s.message]}},p=async(l,s,a)=>{try{const o=te(s,a),{payload:t,errors:u}=await F(`&handler=task&dataset=filterAddresses&currentUserId=224${o}`,JSON.stringify({addressText:{text:l}}));t.value?(e.serviceLocations=t.value.items,e.totalItems=t.value.totalPages*parseInt(t.value.pageSize)):(e.serviceLocations=[],e.totalItems=0),e.errors=u.value}catch(o){console.error(o),e.errors=[o.message]}},j=async l=>{try{const{payload:s,errors:a}=await F(`&handler=task&dataset=cancel&taskId=${l}`,null);e.job=s.value,e.errors=a.value}catch(s){console.error(s),e.errors=[s.message]}};return{...ce(e),list:n,load:r,cancel:j,filterAddresses:p,printServiceReport:v}},{job:se,jobs:$e,serviceLocations:je,list:Se,load:Fe,cancel:Pe,filterAddresses:Be,printServiceReport:Ae,printUrl:Je,totalItems:ae,errors:J}=xe();class Ve{async getJobs(n,r){return await Se(n,r),{jobs:$e,totalItems:ae,errors:J}}async getJobById(n,r){return await Fe(n,r),{job:se,errors:J}}async getServiceLocations(n="",r,v){return await Be(n,r,v),{serviceLocations:je,totalItems:ae,errors:J}}async cancelJobById(n){return await Pe(n),{job:se,errors:J}}async getPrintUrlById(n){return await Ae(n),{printUrl:Je,errors:J}}}const Me=()=>{const e=Q({comments:[],comment:null,totalPages:0,errors:[]}),n=async(l,s=0,a=20)=>{try{const{payload:o,errors:t}=await H(`&handler=comment&dataset=listForCase&caseId=${l}&page=${s}&pageSize=${a}`);if(o.value){const u=o.value;e.comments=u.items,e.totalPages=u.totalPages}else e.comments=[],e.totalPages=0;e.errors=t.value}catch(o){console.error(o),e.errors=[o.message]}},r=async(l,s=0,a=20)=>{try{const{payload:o,errors:t}=await H(`&handler=comment&dataset=listForTask&taskId=${l}&page=${s}&pageSize=${a}`);if(o.value){const u=o.value;e.comments=u.items,e.totalPages=u.totalPages}else e.comments=[],e.totalPages=0;e.errors=t.value}catch(o){console.error(o),e.errors=[o.message]}},v=async(l,s,a,o=!1)=>{try{const{payload:t,errors:u}=await F(`&handler=comment&dataset=addToCase&caseId=${l}&currentUserId=${s}`,JSON.stringify({commentText:a,isInternal:o}));t.value&&(e.comment=t.value),e.errors=u.value}catch(t){console.error(t),e.errors=[t.message]}},p=async(l,s,a,o=!1)=>{try{const{payload:t,errors:u}=await F(`&handler=comment&dataset=addToTask&taskId=${l}&currentUserId=${s}`,JSON.stringify({commentText:a,isInternal:o}));t.value&&(e.comment=t.value),e.errors=u.value}catch(t){console.error(t),e.errors=[t.message]}},j=async(l,s)=>{try{const{payload:a,errors:o}=await F(`&handler=comment&dataset=delete&commentId=${l}&currentUserId=${s}`,null);if(o.value.length>0)return e.errors=o.value,!1;const t=a.value;return t.success?!0:(e.errors=[t.error],!1)}catch(a){return console.error(a),e.errors=[a.message],!1}};return{...ce(e),listForCase:n,listForTask:r,addToCase:v,addToTask:p,deleteComment:j}},{comments:re,comment:oe,totalPages:ne,errors:V,listForCase:Le,listForTask:Ne,addToCase:Ee,addToTask:Oe,deleteComment:Re}=Me();class ze{async getCommentsForCase(n,r=0,v=20){return await Le(n,r,v),{comments:re,totalPages:ne,errors:V}}async getCommentsForTask(n,r=0,v=20){return await Ne(n,r,v),{comments:re,totalPages:ne,errors:V}}async addCommentToCase(n,r,v,p=!1){return await Ee(n,r,v,p),{comment:oe,errors:V}}async addCommentToTask(n,r,v,p=!1){return await Oe(n,r,v,p),{comment:oe,errors:V}}async deleteComment(n,r){return{success:await Re(n,r),errors:V}}}const qe="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='user-plus'%20clip-path='url(%23clip0_463_524)'%3e%3cpath%20id='Icon'%20d='M13.3335%2017.5V15.8333C13.3335%2014.9493%2012.9823%2014.1014%2012.3572%2013.4763C11.7321%2012.8512%2010.8842%2012.5%2010.0002%2012.5H4.16683C3.28277%2012.5%202.43493%2012.8512%201.80981%2013.4763C1.18469%2014.1014%200.833496%2014.9493%200.833496%2015.8333V17.5M16.6668%206.66667V11.6667M19.1668%209.16667H14.1668M10.4168%205.83333C10.4168%207.67428%208.92444%209.16667%207.0835%209.16667C5.24255%209.16667%203.75016%207.67428%203.75016%205.83333C3.75016%203.99238%205.24255%202.5%207.0835%202.5C8.92444%202.5%2010.4168%203.99238%2010.4168%205.83333Z'%20stroke='white'%20stroke-width='1.67'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_463_524'%3e%3crect%20width='20'%20height='20'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",De={},He={src:qe,alt:"User"};function Ke(e,n){return h(),w("img",He)}const Ge=Z(De,[["render",Ke]]),W=e=>(ve("data-v-01421bf1"),e=e(),pe(),e),Qe={class:"comment-section"},Ze=W(()=>d("h3",{class:"section-title"},"Comments",-1)),We={class:"add-comment-form"},Xe={class:"form-actions"},Ye={key:0,class:"comments-list"},et={class:"comment-avatar"},tt={class:"avatar-circle"},st={key:0},at={class:"comment-content"},rt={class:"comment-header"},ot={class:"comment-author"},nt={class:"comment-date"},lt=["onClick"],ct={class:"comment-text"},it={key:0,class:"internal-badge"},dt={key:0,class:"load-more"},ut={key:1,class:"empty-state"},mt=W(()=>d("p",null,"No comments yet. Be the first to add one!",-1)),vt=[mt],pt={key:2,class:"loading-state"},yt=W(()=>d("p",null,"Loading comments...",-1)),_t=[yt],le=10,ht=ie({__name:"CommentSection",props:{recordType:{},recordId:{},currentUserId:{}},emits:["commentAdded","commentDeleted"],setup(e,{emit:n}){const r=e,v=n,{setAlert:p}=de(),{getCommentsForCase:j,getCommentsForTask:l,addCommentToCase:s,addCommentToTask:a,deleteComment:o}=new ze,t=k([]),u=k(""),I=k(!1),C=k(!1),f=k(0),T=k(0),B=K(()=>t.value.length>0),O=K(()=>f.value<T.value-1),U=async(c=0,g=!1)=>{I.value=!0;try{let i;if(r.recordType==="case"?i=await j(r.recordId,c,le):i=await l(r.recordId,c,le),i.errors.value.length>0){p();return}g?t.value=[...t.value,...i.comments.value]:t.value=i.comments.value,T.value=i.totalPages.value,f.value=c}catch(i){console.error("Error loading comments",i),p()}finally{I.value=!1}},L=async()=>{await U(f.value+1,!0)},R=async()=>{if(u.value.trim()){C.value=!0;try{let c;if(r.recordType==="case"?c=await s(r.recordId,r.currentUserId,u.value,!1):c=await a(r.recordId,r.currentUserId,u.value,!1),c.errors.value.length>0){p();return}u.value="",await U(),v("commentAdded",c.comment.value)}catch(c){console.error("Error submitting comment",c),p()}finally{C.value=!1}}},z=async c=>{if(confirm("Are you sure you want to delete this comment?"))try{if(!(await o(c,r.currentUserId)).success){p();return}t.value=t.value.filter(i=>i.id!==c),v("commentDeleted",c)}catch(g){console.error("Error deleting comment",g),p()}},N=c=>{if(!c)return"";try{return new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return c}},q=c=>{if(!c)return"?";const g=c.trim().split(" ");return g.length===1?g[0].charAt(0).toUpperCase():(g[0].charAt(0)+g[g.length-1].charAt(0)).toUpperCase()};return ue(async()=>{await U()}),(c,g)=>(h(),w("div",Qe,[Ze,d("div",We,[P(Ie,{modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=i=>u.value=i),placeholder:"Add a comment...",rows:3},null,8,["modelValue"]),d("div",Xe,[P(G,{text:"Add Comment",type:"primary",callback:R,disabled:!u.value.trim()||C.value},null,8,["disabled"])])]),B.value?(h(),w("div",Ye,[(h(!0),w(me,null,he(t.value,i=>(h(),w("div",{key:i.id,class:"comment-item"},[d("div",et,[d("div",tt,[i.portalUserName?(h(),w("span",st,M(q(i.portalUserName)),1)):(h(),E(Ge,{key:1}))])]),d("div",at,[d("div",rt,[d("span",ot,M(i.portalUserName||"Unknown User"),1),d("span",nt,M(N(i.createdDate)),1),i.portalUserId===c.currentUserId?(h(),w("button",{key:0,class:"delete-btn",onClick:m=>z(i.id),title:"Delete comment"},[P(we)],8,lt)):$("",!0)]),d("div",ct,M(i.commentText),1),i.isInternal?(h(),w("div",it,"Internal")):$("",!0)])]))),128)),O.value?(h(),w("div",dt,[P(G,{text:"Load More",type:"secondary",callback:L,disabled:I.value},null,8,["disabled"])])):$("",!0)])):I.value?$("",!0):(h(),w("div",ut,vt)),I.value?(h(),w("div",pt,_t)):$("",!0)]))}}),gt=Z(ht,[["__scopeId","data-v-01421bf1"]]),ye=e=>(ve("data-v-bf145573"),e=e(),pe(),e),ft={class:"job-detail-wrapper"},bt={class:"job-header-wrapper"},wt={class:"job-info-wrapper"},kt={class:"job-title-wrapper"},Ct={class:"bc-text bc-text-gray-800 bc-fs-24 m-0 p-0 task-title"},It={key:1,class:"comments-wrapper"},Tt={class:"job-button-wrapper"},Ut={class:"button-wrapper"},xt=ye(()=>d("span",{class:"bc-text bc-text-gray-900 bc-fs-18 bc-fw-600"},"Are you certain about canceling this Task?",-1)),$t=ye(()=>d("span",{class:"bc-text bc-text-gray-500"},[D("Are you certain about canceling this Task? Continuing will lock the Task and designate it as cancelled. For any changes or inquiries regarding the Task request or other details, reach out to us via email at "),d("u",null,"testcompany@test.com"),D(" or by phone at "),d("u",null,"555-555-5555"),D(".")],-1)),jt=ie({__name:"JobDetailView",props:{jobId:{}},setup(e,{expose:n}){const{user:r,load:v}=ge(),p=K(()=>{var m;return((m=r.value)==null?void 0:m.id)||""}),j=k(null),{jobId:l}=e,{setAlert:s}=de(),{getJobById:a,cancelJobById:o,getPrintUrlById:t}=new Ve,{getEntryForm:u}=new ke,I=k(0),C=k(!1),f=k(!1),T=Q({taskType:"",taskTitle:""}),B=k([]),O=k([]),U=k(!1),L=async()=>{await i(!0),I.value++,C.value=!0},R=m=>{o(m)},z=()=>{N(),R(l),L()},N=()=>{f.value=!f.value},q=async()=>{try{const{printUrl:m,errors:y}=await t(l);y&&y.value.length>0?(console.error("Error fetching report URL",y),s()):m&&m.value&&window.open(m.value,"_blank")}catch(m){console.error("Error handling print service report",m),s()}},c=async(m,y)=>{const{job:x,errors:A}=await a(m,y.value);if(A.value.length>0)console.error("Error loading job",A.value),s(),U.value=!1;else return x},g=async()=>{const{entryForm:m,errors:y}=await u("TASK");if(y.value.length>0)console.error("Error loading job entry form",y.value),s(),U.value=!1;else return m},i=async(m=!1)=>{var A,X,Y,ee;U.value=!0;const y=await g();y.value.groups.push({visible:!1,label:"UI Injected Fields",fields:[{id:"custevent_nx_task_type",label:"Task Type",visible:!1},{id:"custevent_fsm_bc_is_canceled",label:"Is Canceled",visible:!1}]}),y.value.groups[0].fields.push({id:"task_service_report",label:"Task Service Report",visible:!0});const x=await c(l,y);C.value=m||((A=x.value.bodyFields.find(b=>b.id==="custevent_fsm_bc_is_canceled"))==null?void 0:A.value),B.value=y.value.groups.map(b=>({...b,fields:b.fields.filter(S=>S.visible).map(S=>{const _=x.value.bodyFields.find(_e=>_e.id===S.id);return(_==null?void 0:_.id)==="status"?{...S,value:_==null?void 0:_.value,text:C.value?"Canceled":_==null?void 0:_.text}:{...S,value:_==null?void 0:_.value,text:_==null?void 0:_.text}})})),O.value=y.value.tabs.map(b=>({...b,groups:b.groups.map(S=>({...S,fields:S.fields.filter(_=>_.visible)}))})),C.value=(X=x.value.bodyFields.find(b=>b.id==="custevent_bc_task_is_canceled"))==null?void 0:X.value,T.taskType=(Y=x.value.bodyFields.find(b=>b.id==="custevent_nx_task_type"))==null?void 0:Y.text,T.taskTitle=(ee=x.value.bodyFields.find(b=>b.id==="title"))==null?void 0:ee.text,U.value=!1};return ue(async()=>{await Promise.all([i(),v()])}),n({wrapper:j,cancelTask:L}),(m,y)=>(h(),w(me,null,[d("div",{class:"wrapper",ref_key:"wrapper",ref:j},[d("div",ft,[d("div",bt,[d("div",wt,[P(Ce,{text:T.taskType,type:"primary"},null,8,["text"]),d("div",kt,[d("h2",Ct,M(T.taskTitle),1)])])]),B.value.length>0?(h(),E(Te,{key:I.value,items:B.value,type:"list",onPrintServiceReport:q},null,8,["items"])):$("",!0),m.jobId&&p.value?(h(),w("div",It,[P(gt,{recordType:"task",recordId:m.jobId,currentUserId:p.value.toString()},null,8,["recordId","currentUserId"])])):$("",!0)]),d("div",Tt,[d("div",Ut,[C.value?$("",!0):(h(),E(G,{key:0,text:"Cancel Task",type:"danger",callback:N}))])])],512),P(Ue,{modelValue:f.value,"onUpdate:modelValue":y[0]||(y[0]=x=>f.value=x),onOnOk:z,type:"warning"},{content:fe(()=>[xt,$t]),_:1},8,["modelValue"]),U.value?(h(),E(be,{key:0})):$("",!0)],64))}}),St=Z(jt,[["__scopeId","data-v-bf145573"]]),Vt=Object.freeze(Object.defineProperty({__proto__:null,default:St},Symbol.toStringTag,{value:"Module"}));export{St as J,Ve as a,Vt as b};
