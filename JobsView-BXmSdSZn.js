import{J as he,a as ye}from"./JobDetailView-DXx5r_xF.js";import{f as xe,t as we,g as ke,d as Ie,i as Ce,r as o,w as Te,o as Se,c as Ve,j as i,k as f,q as l,F as Fe,b as Pe,m as L,v as Je,C as je,D as Ue,_ as Le}from"./index-njxYMIA0.js";import{_ as De,E as Ee}from"./IconClose.vue_vue_type_script_setup_true_lang-ChXQ_y-i.js";import{P as Oe}from"./PageView-BfH8tsmj.js";import{u as Me,I as $e,B as Z}from"./helpers-BA9LEKSq.js";import{B as Ae}from"./BlueCollarDropDown-BW_XbvPt.js";import{B as He}from"./BlueCollarForm-TCyGM1Se.js";import{_ as ze,H as Ne}from"./index-BPFpVZYo.js";import{d as Re}from"./index-CS5tPIud.js";import{B as ee}from"./BlueCollarModal-BuahIIZF.js";import"./BlueCollarBadge-QXQIXcG4.js";import"./BlueCollarContent-OVW-PlcV.js";const qe=()=>{const u=xe({jobTypes:[],errors:[]}),C=async D=>{try{const{payload:b,errors:E}=await ke(`&handler=task_type&dataset=filter&namePattern=${D}`);b.value?u.jobTypes=b.value:u.jobTypes=[],u.errors=E.value}catch(b){console.error(b),u.errors=[b.message]}};return{...we(u),filter:C}},{jobTypes:Be,filter:Ge,errors:Ke}=qe();class Qe{async getJobTypes(C=""){return await Ge(C),{jobTypes:Be,errors:Ke}}}const v=u=>(je("data-v-07d12155"),u=u(),Ue(),u),We=v(()=>l("div",{class:"divider mb-3"},null,-1)),Xe={class:"gap-3 filter-wrapper",id:"filter"},Ye={class:"filter-field-wrapper"},Ze={class:"form-group"},ea=v(()=>l("label",{class:"bc-text-dark",for:"type"},"Type",-1)),aa={class:"form-group",style:{width:"28%"}},ta=v(()=>l("label",{for:"service-location",class:"bc-text-dark"},"Service Location",-1)),sa={class:"form-group"},la=v(()=>l("label",{class:"bc-text-dark",for:"task-status"},"Task Status",-1)),oa={class:"form-group"},na=v(()=>l("label",{class:"bc-text-dark",for:"date"},"Date",-1)),ra={class:"pt-3 px-4 w-100 bg-white"},ca={class:"container-fluid py-2",id:"job-item"},ia={class:"card"},ua={class:"card-body"},da={class:"job-detail-form-header"},va=v(()=>l("div",{class:"bc-text bc-text-gray-900 bc-fw-500"},"Job Detail",-1)),ma={class:"form-header-actions"},pa=v(()=>l("span",{class:"bc-text bc-text-gray-900 bc-fs-18 bc-fw-600"},"Are you certain about canceling this Task?",-1)),ba=v(()=>l("span",{class:"bc-text bc-text-gray-500"},[L("Are you certain about canceling this Task? Continuing will lock the Task and designate it as cancelled. For any changes or inquiries regarding the Task request or other details, reach out to us via email at "),l("u",null,"testcompany@test.com"),L(" or by phone at "),l("u",null,"555-555-5555"),L(".")],-1)),ga=v(()=>l("span",{class:"bc-text bc-text-gray-800 bc-fs-16 bc-fw-600 text-center"}," This Task has been canceled. ",-1)),fa=v(()=>l("span",{class:"bc-text bc-text-gray-500 text-center"}," Please contact support if you believe this is an error. ",-1)),_a=Ie({__name:"JobsView",setup(u){const{getJobs:C,getServiceLocations:D,getJobById:b,cancelJobById:E}=new ye,{getJobTypes:ae}=new Qe,{getEntryForm:te}=new Ee,{setAlert:T}=Ce(),{handleUserPreference:N}=Me(),p=o(null),P=o({}),R=o(null),J=o(!1),q=o(0),se=o(null),d=o(!1),le=o([{text:"View",value:"view"},{text:"Cancel",value:"cancel"}]),_=o(Re),B=o([]),G=o([]),oe=window.innerHeight*.48,O=o([{text:"All",value:"all"},{text:"Not Started",value:"status|NOTSTART"},{text:"Completed",value:"status|COMPLETE"},{text:"In Progress",value:"status|PROGRESS"}]),M=o([]),K=o([]),h=o(null),g=o(O.value[0]),$=o(null),S=o(""),A=o([]),H=o([]),y=o(!1),j=o(!1),Q=()=>{R.value.clearValue()},ne=()=>{h.value=null,H.value=[],g.value=O.value[0],$.value=null,A.value=[],Q(),x({page:1,itemsPerPage:_.value})},W=(t,e="is",a)=>{const s=re(t,e);return a?a==null||a.push(s):a=[s],a},re=(t,e)=>{var a,s;return{key:(a=t.value.value)==null?void 0:a.split("|")[0],operator:e,value:(s=t.value.value)==null?void 0:s.split("|")[1]}},z=t=>{J.value=!0,S.value=t},ce=async t=>{d.value=!0,await de(t)?j.value=!j.value:(S.value=t,y.value=!y.value),d.value=!1},ie=async()=>{d.value=!0,y.value=!y.value;const{job:t,errors:e}=await E(S.value);e.value.length>0?(console.error("Error Cancel Task:",e.value),T(),d.value=!1):(await X(),z(S.value)),d.value=!1},ue=async()=>{const{entryForm:t,errors:e}=await te("TASK");if(e.value.length>0)console.error("Error loading job entry form",e.value),T(),d.value=!1;else return t},de=async t=>{var m;const e=await ue();e.value.groups.push({visible:!1,label:"UI Injected Fields",fields:[{id:"custevent_fsm_bc_is_canceled",label:"Is Canceled",visible:!1}]});const{job:a,errors:s}=await b(t,e.value);return s.value.length>0&&(console.error("Error fetching job data",s.value),T(),d.value=!1),((m=a.value.bodyFields.find(r=>r.id==="custevent_fsm_bc_is_canceled"))==null?void 0:m.value)||!1},ve=(t,e)=>{switch(t.stopPropagation(),t.target.innerText){case"View":z(e.internalid);break;case"Cancel":ce(e.internalid);break}},me=(t,e)=>{var s;const a=(s=e==null?void 0:e.item)==null?void 0:s.internalid;a?z(a):console.warn("Internal Id not found in the row data:",e)},pe=t=>{var e,a;$.value={value:(e=t[0])==null?void 0:e.value,text:(a=t[0])==null?void 0:a.text},x({page:1,itemsPerPage:_.value})},be=t=>{var e,a;h.value=t.length?{value:(e=t[0])==null?void 0:e.id,text:(a=t[0])==null?void 0:a.name}:null,x({page:1,itemsPerPage:_.value})},x=async({page:t,itemsPerPage:e,sortBy:a,filterBy:s})=>{var V,F,w,U,Y;d.value=!0,h.value&&h.value.value!=="all"&&((V=h.value.value)!=null&&V.includes("custevent_nx_task_type"))&&(s=W(h,"is",s)),g.value&&g.value.value!=="all"&&(s=W(g,"is",s)),p.value&&(s=s?s.concat({key:"custevent_nx_start_date",operator:"onorbefore",value:p.value}):[{key:"custevent_nx_start_date",operator:"onorbefore",value:p.value}]);const{jobs:n,totalItems:m,errors:r}=await C({page:t,pageSize:e,sortBy:a,filterBy:s},(F=$.value)==null?void 0:F.value);return r.value.length>0&&r.value[0]!=="Invalid page range: fetch."?(console.error("Error loading jobs:",r.value),T(),d.value=!1):(B.value=((w=n.value)==null?void 0:w.length)>0?n.value[0].reduce((k,c)=>(c.id!=="internalid"&&c.id!=="custevent_fsm_bc_is_canceled"&&k.push({title:c.label,key:c.id}),k),[]).concat({title:"Actions",key:"actions"}):[],G.value=(U=n.value)==null?void 0:U.map(k=>k.reduce((c,I)=>(I.id&&(c[I.id]=I.text??I.value),c),{})),(Y=n.value)==null||Y.map(k=>{k.map(c=>{const I={text:c.text,value:`${c.id}|${c.value}`};c.label==="Type"&&M.value.findIndex(_e=>_e.text===c.text)===-1&&M.value.push(I)})}),q.value=m.value,d.value=!1),n},ge=async(t,e)=>{const{search:a,pageNumber:s,pageSize:n}=t,{serviceLocations:m,totalItems:r,errors:V}=await D(a,s,n);if(V.value.length>0){console.error("Error loading service locations:",V.value);return}const F=m.value.map((w,U)=>({...w[0],id:U,name:w[0].text||w[0].value}));e(F,F.length)},fe=async(t,e)=>{const{search:a}=t,{jobTypes:s,errors:n}=await ae(a);n.value.length>0?(console.error("Error loading task type items:",n.value),T()):M.value=s.value.map(r=>({text:r.bodyFields[0].text,value:`custevent_nx_task_type|${r.id}`}));const m=s.value.map(r=>({...r,id:`custevent_nx_task_type|${r.id}`,name:r.bodyFields[0].text}));e(m,m.length)},X=async()=>{await N(p,P),await x({page:1,itemsPerPage:_.value})};return Te([g,p],()=>{x({page:1,itemsPerPage:_.value})}),Se(async()=>{await N(p,P)}),(t,e)=>(Pe(),Ve(Fe,null,[i(Oe,null,{icon:f(()=>[l("span",null,[i($e)])]),pagename:f(()=>[L("Jobs")]),content:f(()=>{var a,s;return[We,l("div",Xe,[l("div",Ye,[l("div",Ze,[ea,i(Z,{id:"type",name:"type",modelValue:H.value,"onUpdate:modelValue":e[0]||(e[0]=n=>H.value=n),onFetchData:fe,onSelectionChange:be,placeholder:"Select a Type",pageination:!1},null,8,["modelValue"])]),l("div",aa,[ta,i(Z,{id:"serviceLocation",name:"serviceLocation",modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=n=>A.value=n),onFetchData:ge,onSelectionChange:pe,placeholder:"Select a Service Location",pagination:!1},null,8,["modelValue"])]),l("div",sa,[la,i(Ae,{items:O.value,modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=n=>g.value=n),name:"task-status",id:"task-status"},null,8,["items","modelValue"])]),l("div",oa,[na,i(Je(Ne),{id:"date",name:"date",placeholder:"Select Date",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=n=>p.value=n),format:((a=P.value)==null?void 0:a.dateFormat)||"dd/MM/yyyy","model-type":((s=P.value)==null?void 0:s.dateFormat)||"dd/MM/yyyy",onClear:e[4]||(e[4]=n=>Q()),"enable-time-picker":!1,ref_key:"datePicker",ref:R},null,8,["modelValue","format","model-type"])])])])]}),_:1}),l("div",ra,[l("section",ca,[l("div",ia,[l("div",ua,[i(ze,{tableHeaders:B.value,tableItems:G.value,loading:d.value,itemsLength:q.value,selectedItems:K.value,pageSize:_.value,tableHeight:oe,optionItems:le.value,onRefreshTable:X,onClearFilters:ne,onUpdateOptions:x,"onUpdate:selectedItems":e[5]||(e[5]=a=>K.value=a),onRowClick:me,onViewItem:ve},null,8,["tableHeaders","tableItems","loading","itemsLength","selectedItems","pageSize","optionItems"])])])])]),i(He,{modelValue:J.value,"onUpdate:modelValue":e[7]||(e[7]=a=>J.value=a)},{header:f(()=>[l("div",da,[va,l("div",ma,[l("span",{class:"form-action",onClick:e[6]||(e[6]=a=>J.value=!1)},[i(De,{type:"secondary"})])])])]),content:f(()=>[i(he,{jobId:S.value,ref_key:"jobDetailForm",ref:se},null,8,["jobId"])]),_:1},8,["modelValue"]),i(ee,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),onOnOk:ie,type:"warning"},{content:f(()=>[pa,ba]),_:1},8,["modelValue"]),i(ee,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=a=>j.value=a)},{content:f(()=>[ga,fa]),_:1},8,["modelValue"])],64))}}),ja=Le(_a,[["__scopeId","data-v-07d12155"]]);export{ja as default};
