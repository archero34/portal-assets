import{f as ae,t as oe,u as me,g as L,h as K,d as H,b as f,c as g,r as p,E as U,l as F,q as e,s as P,e as Q,y as A,j as w,F as W,C as z,D as X,_ as Z,w as se,o as pe,G as ne,H as re,k as R,m as le,U as _e,I as ee,J as ye,x as he,K as fe}from"./index-njxYMIA0.js";import{a as Y,I as be}from"./BlueCollarModal-BuahIIZF.js";import{B as we}from"./BlueCollarInput-Bbfj4CwT.js";const ge=()=>{const t=ae({invoices:[],invoice:{},totalItems:0,url:"",errors:[]}),s=async(a,i,u,_)=>{try{const m=me(a,i,u,_),{payload:l,errors:y}=await L(`&handler=invoice&dataset=list${m}`);l.value?(t.invoices=l.value.items,t.totalItems=l.value.totalPages*parseInt(l.value.pageSize)):(t.invoices=[],t.totalItems=0),t.errors=y.value}catch(m){console.error(m),t.errors=[m.message]}},n=async(a,i)=>{try{const{payload:u,errors:_}=await K(`&handler=invoice&dataset=load&invoiceId=${a}`,JSON.stringify(i));t.invoice=u.value,t.errors=_.value}catch(u){console.error(u),t.errors=[u.message]}},o=async a=>{try{const{payload:i,errors:u}=await L(`&handler=files&dataset=printTransaction&invoiceId=${a}&enumValue=INVOICE`,"blob");i.value&&(t.url=window.URL.createObjectURL(i.value)),t.errors=u.value}catch(i){console.error(i),t.errors=[i.message]}};return{...oe(t),list:s,print:o,load:n}},{invoice:ke,invoices:Se,list:xe,print:Ie,totalItems:Pe,url:$e,load:De,errors:q}=ge();class sa{async getInvoices(s,n,o,a){return await xe(s,n,o,a),{invoices:Se,totalItems:Pe,errors:q}}async getInvoiceById(s,n){return await De(s,n),{invoice:ke,errors:q}}async printInvoice(s){return await Ie(s),{url:$e.value,errors:q}}}const Ce="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='vuesax/linear/stickynote'%3e%3cg%20id='stickynote'%3e%3cpath%20id='Vector'%20d='M8%202V5'%20stroke='%23292D32'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_2'%20d='M16%202V5'%20stroke='%23292D32'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_3'%20d='M7%2011H15'%20stroke='%23292D32'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_4'%20d='M7%2015H12'%20stroke='%23292D32'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_5'%20d='M15%2022H9C4%2022%203%2019.94%203%2015.82V9.65C3%204.95%204.67%203.69%208%203.5H16C19.33%203.68%2021%204.95%2021%209.65V16'%20stroke='%23292D32'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_6'%20d='M21%2016L15%2022V19C15%2017%2016%2016%2018%2016H21Z'%20stroke='%23292D32'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Ve="data:image/svg+xml,%3csvg%20width='24'%20height='25'%20viewBox='0%200%2024%2025'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='vuesax/linear/stickynote'%3e%3cg%20id='stickynote'%3e%3cpath%20id='Vector'%20d='M8%202.5V5.5'%20stroke='%23FCFCFD'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_2'%20d='M16%202.5V5.5'%20stroke='%23FCFCFD'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_3'%20d='M7%2011.5H15'%20stroke='%23FCFCFD'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_4'%20d='M7%2015.5H12'%20stroke='%23FCFCFD'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_5'%20d='M15%2022.5H9C4%2022.5%203%2020.44%203%2016.32V10.15C3%205.45%204.67%204.19%208%204H16C19.33%204.18%2021%205.45%2021%2010.15V16.5'%20stroke='%23FCFCFD'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_6'%20d='M21%2016.5L15%2022.5V19.5C15%2017.5%2016%2016.5%2018%2016.5H21Z'%20stroke='%23FCFCFD'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Te={key:0,src:Ce,alt:"Invoice"},Fe={key:1,src:Ve,alt:"Invoice"},na=H({__name:"IconInvoice",props:{type:{default:"dark"}},setup(t){const{type:s}=t;return(n,o)=>s==="dark"?(f(),g("img",Te)):(f(),g("img",Fe))}}),G=999999.99,J=1,ie=()=>({createPaymentIntent:async(o,a,i)=>{const u=JSON.stringify({data:{amount:o,currency:a,description:i}}),{payload:_,errors:m}=await K("&handler=stripe&dataset=createIntent",u);return{payload:_.value,errors:m.value}},confirmPaymentIntent:async(o,a,i,u,_)=>{const m=JSON.stringify({data:{intentId:o,paymentMethod:a,returnUrl:i,invoiceId:u,amount:_}}),{payload:l,errors:y}=await K("&handler=stripe&dataset=confirmIntent",m);return{payload:l.value,errors:y.value}},getPublishableKey:async()=>{const{payload:o,errors:a}=await L("&handler=stripe&dataset=getPublicStripeKey");return{payload:o.value,errors:a.value}}}),M=t=>(z("data-v-35bac3f9"),t=t(),X(),t),Ae={class:"amount-wrapper"},Me=M(()=>e("div",{class:"amount-title bc-fs-16 bc-fw-600 bc-text"},"Amount Details",-1)),Ee={class:"amount-items"},je={class:"amount-item bc-fs-16 bc-fw-500"},Ne=M(()=>e("span",{class:"bc-text-gray-500"},"Subtotal",-1)),Be={style:{color:"black"}},Ue={class:"amount-item bc-fs-16 bc-fw-500"},Le=M(()=>e("span",{class:"bc-text-gray-500"},"Total",-1)),Re={style:{color:"black"}},He=M(()=>e("div",{class:"amount-divider"},null,-1)),Oe={class:"button-group"},qe=["disabled"],Ke=["disabled"],Ye={class:"bc-text amount-pay"},Ge={key:0,for:"amountTopay",class:"bc-fw-500",style:{color:"black"}},Je={class:"custom-input-wrapper"},We={key:0,class:"bc-text bc-fw-600 amount-later"},ze=M(()=>e("span",null,"Amount to be paid later",-1)),Xe={class:"bc-fs-16"},Ze={class:"amount-action"},Qe=H({__name:"AmountDetails",props:{stepData:{},loading:{type:Boolean}},emits:["updateStepData","nextStep","previousStep","paymentSuccess"],setup(t,{emit:s}){const n=t,o=s,a=p({...n.stepData}),i=p(a.value.amountToPay),u=[r=>!!r||"Amount is required",r=>r>=0||"Amount cannot be negative",r=>r&&r>=J||`Amount must be greater than $${J}`,r=>r&&r<=G||`Amount must be less than or equal to  $${G}`,r=>r<=Number((a.value.amountDetails.total.value-a.value.amountDetails.amountpaid.value).toFixed(2))||`Amount cannot exceed ${Number((a.value.amountDetails.total.value-a.value.amountDetails.amountpaid.value).toFixed(2))}`,r=>(r.toString().split(".")[1]||"").length<=2||"Amount must not have more than two decimal places"],_=r=>{const v=parseFloat(r);if(!isNaN(v)){const k=Math.floor(v*100)/100;if(k.toString().replace(".","").length>8)return;i.value=k,a.value.amountToPay=k,o("updateStepData",a.value)}},m=r=>{var V;const v=r.target;(v.value.replace(".","").length||0)>8&&(v.value=v.value.slice(0,-1)),v.value.includes(".")&&(((V=v.value.split(".")[1])==null?void 0:V.length)||0)>2&&(v.value=v.value.slice(0,-1))},l=p("customAmount"),y=p(!1),C=r=>{l.value===r&&!y.value?y.value=!0:(l.value===r&&y.value||(l.value=r),y.value=!1),l.value==="payTotal"&&(i.value=Number((a.value.amountDetails.total.value-a.value.amountDetails.amountpaid.value).toFixed(2)),a.value.amountToPay=i.value,o("updateStepData",a.value))},d=U(()=>(a.value.amountDetails.total.value-a.value.amountDetails.amountpaid.value-i.value).toFixed(2)),h=r=>{(r.key==="-"||r.key==="e")&&r.preventDefault()},$=()=>o("nextStep");return(r,v)=>{const k=F("v-text-field");return f(),g(W,null,[e("div",Ae,[Me,e("div",Ee,[e("div",je,[Ne,e("span",Be,"$"+P(a.value.amountDetails.subtotal.text),1)]),e("div",Ue,[Le,e("span",Re,"$"+P(a.value.amountDetails.total.text),1)])]),He,e("div",Oe,[e("button",{disabled:r.loading,class:Q(["bc-fw-500","bc-text","button",{"button--active":l.value==="payTotal"},{"button--inactive":l.value!=="payTotal"}]),onClick:v[0]||(v[0]=V=>C("payTotal"))}," Pay total Amount ",10,qe),e("button",{disabled:r.loading,class:Q(["bc-fw-500","bc-text","button",{"button--active":l.value==="customAmount"},{"button--inactive":l.value!=="customAmount"}]),onClick:v[1]||(v[1]=V=>C("customAmount"))}," Custom Amount ",10,Ke)]),e("div",Ye,[l.value==="customAmount"?(f(),g("label",Ge,"Amount to pay now")):A("",!0),e("div",Je,[w(k,{id:"amountTopay",type:"number","model-value":i.value,prefix:"$",variant:"outlined","onUpdate:modelValue":_,onInput:m,onKeydown:h,rules:u,readonly:l.value==="payTotal",class:"custom-input"},null,8,["model-value","readonly"])])]),l.value==="customAmount"?(f(),g("div",We,[ze,e("span",Xe,"$"+P(d.value),1)])):A("",!0)]),e("div",Ze,[w(Y,{text:"Pay Now",type:"primary",callback:$,loading:n.loading},null,8,["loading"])])],64)}}}),et=Z(Qe,[["__scopeId","data-v-35bac3f9"]]);var ce="https://js.stripe.com/v3",tt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,te="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",at=function(){for(var s=document.querySelectorAll('script[src^="'.concat(ce,'"]')),n=0;n<s.length;n++){var o=s[n];if(tt.test(o.src))return o}return null},ot=function(s){var n="",o=document.createElement("script");o.src="".concat(ce).concat(n);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(o),o},st=function(s,n){!s||!s._registerWrapper||s._registerWrapper({name:"stripe-js",version:"1.54.2",startTime:n})},B=null,nt=function(s){return B!==null||(B=new Promise(function(n,o){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&s&&console.warn(te),window.Stripe){n(window.Stripe);return}try{var a=at();a&&s?console.warn(te):a||(a=ot(s)),a.addEventListener("load",function(){window.Stripe?n(window.Stripe):o(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){o(new Error("Failed to load Stripe.js"))})}catch(i){o(i);return}})),B},rt=function(s,n,o){if(s===null)return null;var a=s.apply(void 0,n);return st(a,o),a},ue=Promise.resolve().then(function(){return nt(null)}),de=!1;ue.catch(function(t){de||console.warn(t)});var lt=function(){for(var s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];de=!0;var a=Date.now();return ue.then(function(i){return rt(i,n,a)})};const E=t=>(z("data-v-96d5d0f8"),t=t(),X(),t),it={class:"selecting-wrapper"},ct={class:"selecting-payinfo"},ut=E(()=>e("span",{class:"bc-text bc-text-gray-700 bc-fw-400"},"You will pay now:",-1)),dt={class:"bc-text bc-fs-16 bc-fw-600",style:{color:"black"}},vt=E(()=>e("div",{class:"selecting-divider"},null,-1)),mt={class:"stripe-method"},pt={class:"input-item"},_t=E(()=>e("label",{for:"email",class:"bc-text bc-fw-500 bc-text-gray-700"},"Email",-1)),yt=E(()=>e("div",{class:"input-item"},[e("label",{for:"card-element",class:"bc-text bc-fw-500 bc-text-gray-700"},"Card Number"),e("div",{style:{width:"100%"}},[e("div",{id:"card-element",class:"card-element"})])],-1)),ht={key:0,class:"loading-overlay"},ft=E(()=>e("span",{class:"loading-text"},"Processing Payment...",-1)),bt={class:"form-action"},wt=H({__name:"CardDetails",props:{stepData:{},loading:{type:Boolean}},emits:["updateStepData","nextStep","previousStep","paymentSuccess"],setup(t,{emit:s}){const{confirmPaymentIntent:n,getPublishableKey:o}=ie(),{getUser:a}=new _e,i=t,u=s,_=p({...i.stepData}),m=p(null),l=p(null),y=p(null),C=p(null),d=p(!1),h=p(!1),$=p(""),r=p([{text:"",value:"empty"},{text:"Stripe",value:"stripe"}]),v=p(r.value[1]),k=async()=>{d.value=!0;const{payload:S}=await o(),b=S;if(!b)throw new Error("Stripe API key is missing");l.value=await lt(b),y.value=l.value.elements(),C.value=y.value.create("card"),C.value.mount("#card-element"),d.value=!1};se(v,async S=>{S.value==="stripe"&&!l.value&&await k()}),pe(async()=>{d.value=!0;const{user:S,errors:b}=await a();b.value.length>0?(h.value=!0,$.value="Error loading Invoice"):m.value=S.value,await k(),d.value=!1});const V=async()=>{var S;try{d.value=!0;const{paymentMethod:b,error:T}=await l.value.createPaymentMethod({type:"card",card:C.value,billing_details:{email:((S=m.value)==null?void 0:S.email.text)||"john.doe@bluecollar.cloud"}}),c=encodeURIComponent(window.location.href);if(T)h.value=!0,$.value=T.message;else{const{payload:x,errors:D}=await n(_.value.intent.intentId,b.id,c,_.value.invoiceId,_.value.amountToPay);x&&x.succeeded?u("paymentSuccess"):(h.value=!0,$.value=D[0])}}catch{h.value=!0,$.value="Error processing payment"}finally{d.value=!1}},j=()=>u("previousStep");return(S,b)=>{var D,N;const T=F("v-progress-circular"),c=F("v-alert"),x=F("v-bottom-sheet");return f(),g(W,null,[e("div",it,[e("div",ct,[ut,e("span",dt,"$"+P(_.value.amountToPay),1)]),vt,ne(e("div",mt,[e("div",pt,[_t,w(we,{name:"email",id:"email",type:"text","model-value":(D=m.value)!=null&&D.email.text?(N=m.value)==null?void 0:N.email.text:"john.doe@bluecollar.cloud",class:"bc-text-gray-500",readonly:""},null,8,["model-value"])]),yt],512),[[re,v.value.value==="stripe"]]),d.value?(f(),g("div",ht,[w(T,{size:50,width:5,color:"white",indeterminate:""}),ft])):A("",!0)]),e("div",bt,[w(Y,{text:"Back",type:"danger",callback:j}),w(Y,{text:"Pay Now",type:"primary",loading:d.value,callback:V,disabled:v.value.value==="empty"},null,8,["loading","disabled"])]),w(x,{modelValue:h.value,"onUpdate:modelValue":b[0]||(b[0]=O=>h.value=O),inset:""},{default:R(()=>[w(c,{color:"error",icon:"$error"},{default:R(()=>[le(P($.value),1)]),_:1})]),_:1},8,["modelValue"])],64)}}}),gt=Z(wt,[["__scopeId","data-v-96d5d0f8"]]),I=t=>(z("data-v-830a4d6a"),t=t(),X(),t),kt={key:0,class:"mask-wrapper"},St={class:"form-wrapper"},xt={class:"close-button"},It={key:0,class:"form-header"},Pt=I(()=>e("span",{class:"bc-text bc-fs-20 bc-fw-600 bc-text-gray-modern-700"}," Payment processor",-1)),$t=[Pt],Dt={class:"modal-wrapper"},Ct={class:"icon-success-wrapper"},Vt=I(()=>e("span",{class:"bc-text bc-text-gray-700 bc-fs-24 bc-fw-600 modal-title"},"Payment made successfully",-1)),Tt=I(()=>e("span",{class:"bc-text bc-text-gray-500 bc-fw-400 modal-content"}," Your payment has been processed successfully, we will now redirect you to the invoice ",-1)),Ft=I(()=>e("div",{class:"modal-divider"},null,-1)),At={class:"amount-details"},Mt=I(()=>e("div",{class:"amount-title"},[e("div",{class:"title-item"},[e("span",{class:"bc-text bc-fw-700",style:{color:"black"}},"Amount Details ")]),e("div",{class:"title-divider"})],-1)),Et={key:0,class:"amount-custom"},jt={class:"bc-text total-item"},Nt=I(()=>e("span",{class:"bc-fw-400",style:{color:"black"}},"Total",-1)),Bt={class:"bc-fs-16 bc-fw-600",style:{color:"black"}},Ut=I(()=>e("div",{class:"item-divider"},null,-1)),Lt={class:"bc-text paid-item"},Rt=I(()=>e("span",{class:"bc-fw-400"},"You paid",-1)),Ht={class:"bc-fs-16 bc-fw-600",style:{color:"black"}},Ot=I(()=>e("div",{class:"item-divider"},null,-1)),qt={class:"bc-text bc-text-primary-300 later-item"},Kt=I(()=>e("span",{class:"bc-fw-400"},"Amount to be paid later",-1)),Yt={class:"bc-fs-16 bc-fw-600"},Gt={key:1,class:"bc-text total-item"},Jt=I(()=>e("span",{class:"bc-fw-400",style:{color:"black"}},"You paid the total",-1)),Wt={class:"bc-fs-16 bc-fw-600",style:{color:"black"}},zt=H({__name:"BlueCollarPaymentModal",props:ee({amountDetails:{},invoiceId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ee(["onClose","updateStepData","nextStep","previousStep","paymentSuccess"],["update:modelValue"]),setup(t,{emit:s}){const{createPaymentIntent:n}=ie(),o=t,a=s,i=ye(t,"modelValue"),u=p(1),_=p(!1),m=p(!1),l=p(!1),y=p(""),C=U(()=>Number((o.amountDetails.total.value-o.amountDetails.amountpaid.value).toFixed(2))),d=p({processor:"empty",amountDetails:o.amountDetails,amountToPay:0,intent:{intentId:"",clientSecret:""},invoiceId:o.invoiceId});let h=!1;const $=()=>{h=!0,a("onClose")},r=()=>{l.value=!0,u.value=1},v=c=>c<J||c>G||(c.toString().split(".")[1]||"").length>2||c>C.value?(m.value=!0,y.value="Invalid amount. Please check the value entered.",!0):!1,k=async()=>{h=!1,d.value.invoiceId=o.invoiceId;const{amountToPay:c}=d.value;if(!v(c)){try{_.value=!0;const x=Math.floor(c*100),{payload:D}=await n(x,"usd","Invoice Payment");if(!D)throw new Error("Error Creating Payment Intent");if(h)return;d.value.intent=D}catch(x){h||(m.value=!0,y.value=x.message||"Error Creating Payment Intent")}finally{_.value=!1}u.value++}},V=()=>u.value=1,j=U(()=>u.value===1?et:gt),S=c=>{b(c)?d.value=c:console.error("Invalid data type passed to updateStepData",c)};function b(c){return c.processor!==void 0&&c.amountDetails!==void 0&&c.amountToPay!==void 0&&c.intent!==void 0&&c.invoiceId!==void 0}const T=U(()=>Number((d.value.amountDetails.total.value-d.value.amountDetails.amountpaid.value-d.value.amountToPay).toFixed(2)));return se(i,c=>{c||(l.value=!1,u.value=1,d.value={processor:"empty",amountDetails:o.amountDetails,amountToPay:0,intent:{intentId:"",clientSecret:""},invoiceId:o.invoiceId})}),(c,x)=>{const D=F("v-btn"),N=F("v-alert"),O=F("v-bottom-sheet");return f(),g(W,null,[i.value?(f(),g("div",kt,[e("div",St,[e("div",xt,[w(D,{icon:"mdi-close",color:"white",variant:"text",onClick:$})]),l.value?A("",!0):(f(),g("div",It,$t)),l.value?A("",!0):(f(),he(fe(j.value),{key:1,onUpdateStepData:S,onPreviousStep:V,onNextStep:k,onPaymentSuccess:r,loading:_.value,stepData:d.value},null,40,["loading","stepData"])),ne(e("div",Dt,[e("div",Ct,[w(be)]),Vt,Tt,Ft,e("div",At,[Mt,T.value!==0?(f(),g("div",Et,[e("div",jt,[Nt,e("span",Bt,"$"+P(d.value.amountDetails.total.text),1)]),Ut,e("div",Lt,[Rt,e("span",Ht,"$"+P(d.value.amountToPay),1)]),Ot,e("div",qt,[Kt,e("span",Yt,"$"+P(T.value),1)])])):(f(),g("div",Gt,[Jt,e("span",Wt,"$"+P(d.value.amountDetails.total.text),1)]))])],512),[[re,l.value]])])])):A("",!0),w(O,{modelValue:m.value,"onUpdate:modelValue":x[0]||(x[0]=ve=>m.value=ve),inset:""},{default:R(()=>[w(N,{color:"error",icon:"$error"},{default:R(()=>[le(P(y.value),1)]),_:1})]),_:1},8,["modelValue"])],64)}}}),ra=Z(zt,[["__scopeId","data-v-830a4d6a"]]),Xt=()=>{const t=ae({transactionForm:{},errors:[]}),s=async n=>{try{const{payload:o,errors:a}=await L(`&handler=transaction_form&dataset=load&enumValue=${n}`);t.transactionForm=o.value,t.errors=a.value}catch(o){console.error(o),t.errors=[o.message]}};return{...oe(t),load:s}},{transactionForm:Zt,load:Qt,errors:ea}=Xt();class la{async getTransactionForm(s){return await Qt(s),{transactionForm:Zt,errors:ea}}}export{ra as B,sa as I,la as T,na as _};
